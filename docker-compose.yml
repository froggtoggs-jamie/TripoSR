version: '3.8'

services:
  triposr:
    build: .
    image: triposr:latest
    container_name: triposr
    ports:
      - "7860:7860"
    volumes:
      # Mount output directory to persist generated 3D models
      - ./output:/app/output
      # Optionally mount custom images directory
      - ./examples:/app/examples
    environment:
      - PYTHONUNBUFFERED=1
      # Adjust chunk size based on your GPU VRAM:
      # 11GB+ GPU: 6144-8192, 8GB GPU: 4096, 6GB GPU: 2048-3072
      - TRIPOSR_CHUNK_SIZE=4096
    # GPU support configuration
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    # For older docker-compose versions, use runtime instead:
    # runtime: nvidia
    shm_size: '2gb'
    stdin_open: true
    tty: true
